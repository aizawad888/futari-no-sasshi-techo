<% if post.errors.any? %>
  <div class="bg-cream text-wood-dark text-sm rounded-lg px-4 py-3">
    <ul class="list-disc list-inside space-y-1">
      <% post.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with model: post, data: { turbo: false } do |f| %>
  <div class="space-y-5">

    <!-- 投稿タイトル -->
    <div>
      <%= f.label :title, "タイトル", class: "block text-base font-heading mb-1 text-forest-green" %>
      <%= f.text_field :title, id: "post_title",
            class: "w-full rounded-lg border border-gray-400 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sage" %>
    </div>

    <!-- プリセットボタン -->
    <p class="flex items-center text-xs text-wood-light mt-1">
      登録プリセット　　
      <%= link_to ">>編集", presets_path, class: "underline text-forest-green" %>
    </p>

    <% presets = current_user.presets.order(created_at: :desc) %>
      <% if presets.any? %>
        <div class="mt-2 flex flex-wrap gap-2">
          <% presets.each_with_index do |preset, i| %>
            <button type="button"
                    onclick="document.getElementById('post_title').value = '<%= j preset.title %>'"
                    class="px-2 py-1 text-xs rounded-full bg-sage/20 text-forest-green <%= 'hidden extra-preset' if i >= 3 %>">
              <%= truncate(preset.title, length: 20) %>
            </button>
          <% end %>

          <% if presets.size > 3 %>
            <button type="button"
                    id="toggle-presets"
                    class="px-2 py-1 text-xs rounded-full bg-forest-green text-white">
              ＋ もっと見る
            </button>
          <% end %>
        </div>
      <% end %>



    <!-- カテゴリ -->
    <div>
      <%= f.label :category_id, "カテゴリ",
            class: "block text-base font-heading mb-1 text-forest-green" %>
      <%= f.select :category_id,
        Category.all.map { |c| [c.name, c.id, { "data-hint": c.hint_text }] },
        {},
        { id: "category-select", class: "w-full rounded-lg border border-gray-400 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sage" }
      %>
    </div>

    <p class="mt-2 mb-1 text-description italic">
      相手に表示されるヒント：
    </p>
    <p id="category-hint" class="text-description italic ">
      カテゴリを選ぶと、相手に表示されるヒントが表示されます
    </p>

    <!-- 優先度 -->
    <div>
      <%= f.label :sense_level, "優先度",
            class: "block text-base font-heading mb-1 text-forest-green" %>
      <%= f.select :sense_level,
            Post.sense_levels.keys.map { |k| [Post.sense_level_jp_for(k), k] },
            {},
            class: "w-full rounded-lg border border-gray-400 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sage bg-white" %>
    </div>

    <!-- 答え合わせ -->
    <div>
      <%= f.label :reveal_at, "答え合わせ", class: "block text-base font-heading mb-1 text-forest-green" %>

      <% if f.object.persisted? %>
        <!-- 編集画面：日時直接入力 -->
        <%= f.datetime_local_field :reveal_at,
          value: f.object.reveal_at&.strftime("%Y-%m-%dT%H:%M"),
          class: "w-full rounded-lg border border-gray-400 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sage bg-white" %>
        <p class="text-xs text-wood-light mt-1 ">
          相手に内容が表示される日時を指定できます
        </p>
      <% else %>
        <!-- 新規作成：○分後 select -->
        <% options = [
          ["選択してください", nil],
          ["すぐ公開", 0],
          ["10分後", 600],
          ["30分後", 1800],
          ["1時間後", 3600],
          ["2時間後", 7200],
          ["3時間後", 10800],
          ["6時間後", 21600],
          ["12時間後", 43200],
          ["24時間後", 86400],
          ["2日後", 172800]
        ] %>
        <%= f.select :reveal_offset_seconds,
              options_for_select(options),
              {}, 
              class: "w-full rounded-lg border border-gray-400 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-sage bg-white" %>
        <p class="text-description">
          相手に内容が表示されるタイミングの設定
        </p>
      <% end %>
    </div>


    <!-- 送信 -->
    <div class="pt-4 flex justify-end">
      <%= f.submit "保存する", class: "btn btn-primary" %>
    </div>

  </div>

<% end %>





