<% content_for(:page_title, "#{current_user.name || 'あなた'}と#{@partner&.name || 'あいて'}の察し手帳") %>
<% content_for(:show_back_button, false) %>
<% content_for(:back_path, main_path) %>


<div class="relative z-10 max-w-md mx-auto px-4 py-4 space-y-6 min-h-screen mb-15">


  <% if @partner.nil? %>
    <p class="text-sm text-wood-dark">
      まだペアが設定されていません。
    </p>
  <% else %>
    <div class="text-xs text-wood-dark">
      
    </div>
  <% end %>

  <!-- 検索欄（仮） -->
  <div class="flex items-center space-x-2">
    <input
      type="text"
      placeholder="投稿の検索（工事中）"
      class="flex-1 rounded-lg px-3 py-2 text-sm bg-white shadow-sm"
    />
    <button class="btn btn-secondary">
      検索
    </button>
  </div>

  <!-- 並び替えセレクト -->
  <div class="flex items-center space-x-2 mt-2">
    <%= form_with url: main_path, method: :get, local: true do |f| %>
      <%= f.label :sort, "並び替え:", class: "text-sm font-medium text-wood-dark" %>
      <%= f.select :sort,
            [["優先度順", "priority"], ["投稿が新しい順", "new"], ["答え合わせが近い順", "reveal"]],
            { selected: params[:sort] },
            class: "rounded-lg border px-2 py-1 text-sm"
      %>

      <%= f.submit "適用", class: "btn btn-secondary" %>
    <% end %>
  </div>


  <!-- 投稿一覧 -->
  <div id="posts-list" class="space-y-6">
    <% if @posts.any? %>
      <% @posts.each do |post| %>
        <%= render "posts/post_card",
            post: post,
            last_viewed_at: @last_viewed_at %>
      <% end %>
    <% else %>
      <div class="bg-white rounded-xl p-6 text-wood-light text-sm shadow-sm">
        投稿がまだありません
      </div>
    <% end %>
  </div>
</div>


<!-- 右下の追加ボタン -->
<%= link_to new_post_path,
  class: "fixed bottom-20 right-6 w-14 h-14 bg-accent-orange text-white rounded-full shadow-lg flex items-center justify-center text-3xl transform transition-transform hover:scale-110 hover:shadow-2xl" do %>
  +
<% end %>



<!-- デモモード用 -->
<% if @show_demo_modal %>
  <div id="demo-modal" class="fixed inset-0 z-50 flex items-center justify-center">
    <!-- 透過背景 -->
    <div class="absolute inset-0 bg-black opacity-50"></div>

    <!-- モーダル本体 -->
    <div class="relative bg-white rounded-lg p-6 max-w-md w-full shadow-lg z-10">
      <h2 class="text-lg font-semibold mb-4">デモモードです</h2>
      <ul class="list-disc list-inside space-y-2 text-sm text-gray-700">
        <li>右下の+ボタンから投稿できます</li>
        <li>サンプル投稿を押すと詳細画面に移動します</li>
        <li>「お願いごとがあるみたい！」の投稿は答え合わせ前で、1分後に通知が届きます</li>
        <li>マイページでアイコン変更やペア解消も体験できます</li>
        <li>投稿や設定はログアウト時にリセットされます</li>
        <li>デモモードを同時利用中はデータが上書きされることがあります</li>
      </ul>
      <button class="mt-4 px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 close-modal">閉じる</button>
    </div>
  </div>
<% end %>

<%= image_tag "455.png",
  class: "fixed bottom-0 right-0 w-80 opacity-30 pointer-events-none z-0",
  alt: "" %>






